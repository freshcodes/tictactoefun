{"version":3,"sources":["webpack:///./routes/host_game.js"],"names":["HostGame","Component","constructor","props","super","restart","event","this","controller","newgame","route","boardClick","console","log","game","finished","nextPlayer","player","isEmpty","alert","move","boardIndex","state","connectedToPeer","connectedToPlayer","waiting","error","win","board","ttt","generateEmptyBoard","window","RemoteGameController","X","on","setState","winIndexes","status","draw","xWin","O","oWin","renderConnecting","renderButtons","renderWaitingForPlayer","link","location","href","replace","peer","id","connect","type","value","readonly","renderBoard","click","class","onclick","render"],"mappings":"6FAAA,+GAOe,MAAMA,UAAiBC,YACpCC,YAAaC,GACXC,MAAMD,GADY,KAmCpBE,QAAWC,KACTC,KAAKC,WAAWH,WApCE,KAuCpBI,QAAWH,KACTI,YAAM,MAxCY,KA2CpBC,WAAcL,IACZM,QAAQC,IAAI,aAAcP,EAAOC,KAAKO,MAClCP,KAAKO,KAAKC,UACVR,KAAKO,KAAKE,aAAeT,KAAKU,SAC7BX,EAAMY,SAASC,MAAM,+BAE1BZ,KAAKC,WAAWY,KAAKd,EAAMe,cA9C3Bd,KAAKe,MAAQ,CACXC,iBAAiB,EACjBC,mBAAmB,EACnBC,SAAS,EACTC,OAAO,EACPC,IAAK,GACLC,MAAOC,IAAIC,sBAGS,oBAAXC,SAEXxB,KAAKC,WAAa,IAAIwB,IAAqBH,IAAII,GAC/C1B,KAAKC,WAAW0B,GAAG,QAAQ,IAAM3B,KAAK4B,SAAS,CAAEZ,iBAAiB,MAClEhB,KAAKC,WAAW0B,GAAG,aAAa,IAAM3B,KAAK4B,SAAS,CAAEX,mBAAmB,MACzEjB,KAAKC,WAAW0B,GAAG,oBAAqBpB,IAEtCP,KAAK4B,SAAS,CACZV,QAFclB,KAAKO,KAAKE,aAAeT,KAAKU,OAG5CU,IAAKb,EAAKsB,WACVR,MAAOd,EAAKc,YAKR,aACR,OAAOrB,KAAKC,YAAcD,KAAKC,WAAWS,OAGpC,WACN,OAAOV,KAAKC,YAAcD,KAAKC,WAAWM,KAoB5CuB,SACE,OAAI9B,KAAKO,MAAQP,KAAKO,KAAKC,SACrBR,KAAKO,KAAKwB,KAAa,MACtB/B,KAAKU,SAAWY,IAAII,GAAK1B,KAAKO,KAAKyB,MAAUhC,KAAKU,SAAWY,IAAIW,GAAKjC,KAAKO,KAAK2B,KAAc,UAC5F,WAEAlC,KAAKe,MAAMG,QAAU,aAAe,eAI/CiB,mBACE,OACE,wBACE,sCACCnC,KAAKoC,iBAKZC,yBACE,MAAMC,EAAOd,OAAOe,SAASC,KAAKC,QAAQ,QAAU,WAAUzC,KAAKC,WAAWyC,KAAKC,MAE7EC,EAAW,8DAAyC,qBAAOC,KAAK,OAAOC,MAAOR,EAAMS,UAAQ,KAClG,OACE,wBACE,sDACCH,EACA5C,KAAKoC,iBAKZY,cACE,MAAM3B,EAAQrB,KAAKe,MAAME,kBAAqB,YAAC,IAAD,CAAOG,IAAKpB,KAAKe,MAAMK,IAAKC,MAAOrB,KAAKe,MAAMM,MAAO4B,MAAOjD,KAAKI,aAAkB,wBACjI,OACE,wBACE,8CACA,mBAAK8C,MAAM,iBACR7B,EACD,oBAAM,YAAU,SAAS,cAAY,OAAO6B,MAAM,UAAUlD,KAAK8B,WAElE9B,KAAKoC,iBAKZA,gBACE,MAAMtC,EAAUE,KAAKO,MAAQP,KAAKO,KAAKC,SAAW,sBAAQ2C,QAASnD,KAAKF,SAAtB,WAAkD,GACpG,OACE,qBACGA,EACD,sBAAQqD,QAASnD,KAAKE,SAAtB,aAKNkD,OAAQxD,EAAOmB,GACb,OAAKA,EAAMC,gBACND,EAAME,kBACJjB,KAAKgD,cADyBhD,KAAKqC,yBADPrC,KAAKmC","file":"route-host_game.chunk.dda1e.js","sourcesContent":["import { h, Component } from 'preact'\nimport { route } from 'preact-router'\n\nimport Board from '../components/board'\nimport ttt from '../lib/game'\nimport RemoteGameController from '../lib/remote_game_controller'\n\nexport default class HostGame extends Component {\n  constructor (props) {\n    super(props)\n\n    this.state = {\n      connectedToPeer: false,\n      connectedToPlayer: false,\n      waiting: false,\n      error: false,\n      win: [],\n      board: ttt.generateEmptyBoard()\n    }\n\n    if (typeof window === 'undefined') return\n\n    this.controller = new RemoteGameController(ttt.X)\n    this.controller.on('open', () => this.setState({ connectedToPeer: true }))\n    this.controller.on('connected', () => this.setState({ connectedToPlayer: true }))\n    this.controller.on('updatedGameState', (game) => {\n      const waiting = this.game.nextPlayer !== this.player\n      this.setState({\n        waiting,\n        win: game.winIndexes,\n        board: game.board\n      })\n    })\n  }\n\n  get player () {\n    return this.controller && this.controller.player\n  }\n\n  get game () {\n    return this.controller && this.controller.game\n  }\n\n  restart = (event) => {\n    this.controller.restart()\n  }\n\n  newgame = (event) => {\n    route('/')\n  }\n\n  boardClick = (event) => {\n    console.log('BoardClick', event, this.game)\n    if (this.game.finished) return\n    if (this.game.nextPlayer !== this.player) return\n    if (!event.isEmpty) alert('This space is already taken')\n\n    this.controller.move(event.boardIndex)\n  }\n\n  status () {\n    if (this.game && this.game.finished) {\n      if (this.game.draw) return 'Tie'\n      if ((this.player === ttt.X && this.game.xWin) || (this.player === ttt.O && this.game.oWin)) return 'You won'\n      return 'You lost'\n    } else {\n      return this.state.waiting ? 'Waiting...' : 'Your turn...'\n    }\n  }\n\n  renderConnecting () {\n    return (\n      <main>\n        <p>Connecting...</p>\n        {this.renderButtons()}\n      </main>\n    )\n  }\n\n  renderWaitingForPlayer () {\n    const link = window.location.href.replace('/host', `/remote?${this.controller.peer.id}`)\n    // TODO put link in input with auto select and copy to clip board feature\n    const connect = (<p>Copy and paste this link to a friend: <input type='text' value={link} readonly /></p>)\n    return (\n      <main>\n        <p>Waiting for another player...</p>\n        {connect}\n        {this.renderButtons()}\n      </main>\n    )\n  }\n\n  renderBoard () {\n    const board = this.state.connectedToPlayer ? (<Board win={this.state.win} board={this.state.board} click={this.boardClick} />) : <div />\n    return (\n      <main>\n        <p>You are playing as X.</p>\n        <div class='board-wrapper'>\n          {board}\n          <span aria-live='polite' aria-atomic='true' class='status'>{this.status()}</span>\n        </div>\n        {this.renderButtons()}\n      </main>\n    )\n  }\n\n  renderButtons () {\n    const restart = this.game && this.game.finished ? <button onclick={this.restart}>Restart</button> : ''\n    return (\n      <p>\n        {restart}\n        <button onclick={this.newgame}>New Game</button>\n      </p>\n    )\n  }\n\n  render (props, state) {\n    if (!state.connectedToPeer) return this.renderConnecting()\n    if (!state.connectedToPlayer) return this.renderWaitingForPlayer()\n    return this.renderBoard()\n  }\n}\n"],"sourceRoot":""}